# TomF Specific config (not in shared dotfiles)

# Git credentials (machine-specific) - written to ~/.gitconfig.local
# This file is included by ~/.gitconfig to keep user/gpg settings separate
GIT_AUTHOR_NAME="tomfuertes"
GIT_COMMITTER_NAME="$GIT_AUTHOR_NAME"
GIT_AUTHOR_EMAIL="tomfuertes@gmail.com"
GIT_COMMITTER_EMAIL="$GIT_AUTHOR_EMAIL"

# Write atomically only if changed (safe for parallel shell init)
_gitconfig_local="[user]
	name = $GIT_AUTHOR_NAME
	email = $GIT_AUTHOR_EMAIL
	signingkey = ~/.ssh/id_ed25519.pub
[gpg]
	format = ssh"
[[ -f ~/.gitconfig.local && "$_gitconfig_local" == "$(cat ~/.gitconfig.local)" ]] || echo "$_gitconfig_local" > ~/.gitconfig.local

# SSH agent for signing
eval "$(ssh-agent -s)" > /dev/null 2>&1
ssh-add --apple-use-keychain ~/.ssh/id_ed25519 2>/dev/null

# z (directory jumping)
alias j=z
. $(brew --prefix)/etc/profile.d/z.sh

# fnm (Fast Node Manager)
if command -v fnm &> /dev/null; then
  eval "$(fnm env --use-on-cd --shell zsh)"
fi

# Aliases
alias ll="la -h"
alias c="clear"
alias G="gh browse"
alias b="npx bun"
alias brup="brew update; brew upgrade; brew cleanup"
alias subl=code
alias cursor=code
alias clean='find . -name "*.pyc" -delete; find . -name ".DS_Store" -delete; if [ -d .git ]; then git clean -fdx -- tmp; fi;'

# Editor
export EDITOR='code -w'
export GIT_MERGE_AUTOEDIT=no

# Zsh history
export HISTSIZE=10000000
export SAVEHIST=10000000
setopt BANG_HIST
setopt EXTENDED_HISTORY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_SAVE_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY
setopt HIST_BEEP

# Helper functions for colored output
notice() { echo -e "\033[1;32m=> $1\033[0m"; }
msg() { echo -e "\033[1;34m=> $1\033[0m"; }
error() { echo -e "\033[1;31m=> Error: $1\033[0m"; }

# Update deps workflow
udf() {
  git checkout -b update-deps-$(date +%Y-%m-%d)
  npx npm-check-updates -u --interactive
  git add package*
  git commit -m "npm run update-deps"
  git push --no-verify
  gh pr create
  npm run reset
  npm run audit
}

# Claude Code CLI helpers
cci() {
  claude -p "commit all staged and modified files with a concise commit message. Do NOT add Co-Authored-By or Generated-with lines.${1:+ Context: $1}" \
    --model haiku \
    --verbose \
    --output-format stream-json \
    --allowedTools "Bash(git add:*)" "Bash(git commit:*)" "Bash(git status:*)" "Bash(git diff:*)" "Bash(git log:*)" \
    | jq -r 'select(.type == "assistant" or .type == "result") | if .type == "result" then "✓ \(.result)" elif .message.content then .message.content[] | if .type == "text" then .text elif .type == "tool_use" then "→ \(.name): \(.input.command // .input.description // "")" else empty end else empty end'
}

cpr() {
  local base="${1:-$(git branch --show-current)}"
  claude -p "move the last commit to a new feature branch, reset $base back one commit, push the feature branch, and create a PR targeting $base. Do NOT add Co-Authored-By or Generated-with lines." \
    --model haiku \
    --verbose \
    --output-format stream-json \
    --allowedTools "Bash(git:*)" "Bash(gh pr:*)" \
    | jq -r 'select(.type == "assistant" or .type == "result") | if .type == "result" then "✓ \(.result)" elif .message.content then .message.content[] | if .type == "text" then .text elif .type == "tool_use" then "→ \(.name): \(.input.command // .input.description // "")" else empty end else empty end'
}
